(()=>{function h(u,e,t,s=!0,n=!0){let i=new CustomEvent(u,{detail:e,bubbles:s,composed:!0,cancelable:n});t.dispatchEvent(i)}function f(){return{id:uuidv1(),type:"",event:null,timestamp:new Date().getTime(),source:"system",origin:"repl",state:{}}}function I(u,e=document,t=4e3){let s=e.getElementById("toast-container");if(!s){console.warn("Toast container not found.");return}let n=document.createElement("div");n.className="toast",n.textContent=u,s.appendChild(n),setTimeout(()=>{n.parentNode===s&&n.remove()},t)}function j(u,e={}){let t=e.shadowRoot||document.body,s=t.getElementById("info-modal-backdrop");s&&s.remove();let n=document.createElement("div");n.id="info-modal-backdrop",Object.assign(n.style,{position:"fixed",top:0,left:0,width:"100vw",height:"100vh",backgroundColor:"rgba(0, 0, 0, 0.6)",display:"flex",alignItems:"center",justifyContent:"center",zIndex:9999}),n.onclick=()=>n.remove();let i=document.createElement("div");if(i.id="info-panel",i.onclick=r=>r.stopPropagation(),n.appendChild(i),t.appendChild(n),e.html){let r=function(o){i.querySelectorAll(".tab-content").forEach(c=>c.classList.remove("active")),i.querySelector(`#tab-${o}`)?.classList.add("active"),i.querySelectorAll(".tab-buttons button").forEach(c=>c.classList.remove("active"));let l=Array.from(a).find(c=>c.textContent.toLowerCase().includes(o));l&&l.classList.add("active")};i.innerHTML=`
      <div class="tab-buttons">
        <button class="active" data-tab-id="start">
          <i class="fa fa-solid fa-circle-info"></i> Getting Started
        </button>
        <button data-tab-id="help"><i class="fa fa-solid fa-circle-info"></i> Help</button>
        <button data-tab-id="about"><i class="fa fa-solid fa-lightbulb"></i> About</button>
        <button data-tab-id="contact"><i class="fa fa-solid fa-address-card"></i> Contact</button>
      </div>
      <div id="tab-start" class="tab-content active animated">${u}</div>
      <div id="tab-help" class="tab-content animated">Loading...</div>
      <div id="tab-about" class="tab-content animated">Loading...</div>
      <div id="tab-contact" class="tab-content animated">Loading...</div>
    `;let a=i.querySelectorAll(".tab-buttons button");a.forEach(o=>{o.addEventListener("click",()=>{let l=o.dataset.tabId;l&&r(l)})})}else i.textContent=u}async function b(u,e,t=document){try{let s=await fetch("md/"+u);if(!s.ok)throw new Error(`Failed to load ${u}: ${s.status}`);let n=await s.text(),i=marked.parse(n),r=t.getElementById(e);r&&(r.innerHTML=i)}catch(s){R(e,u,t,s)}}function R(u,e,t=document,s){console.error(`Error loading ${e}:`,s);let n=t.getElementById(u);n&&(n.textContent=`Failed to load ${e}`)}async function S(u,e=document){j("Loading content...",{html:!0,shadowRoot:e}),u.startFile&&b(u.startFile,"tab-start",e),u.helpFile&&b(u.helpFile,"tab-help",e),u.aboutFile&&b(u.aboutFile,"tab-about",e),u.contactFile&&b(u.contactFile,"tab-contact",e)}async function x(u){if(u?.trim())try{await navigator.clipboard.writeText(u.trim())}catch(e){console.error("Failed to copy text:",e)}}function C(u){return u.replace(/[&<>"']/g,e=>({"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;"})[e])}var y=class u{#o=512*1024;#a=1e4;#s=50;static get prompt(){return"prompt"}static get output(){return"output"}static get exception(){return"exception"}static get log(){return"log"}static get warning(){return"warning"}static get error(){return"error"}static get js(){return"js"}static get json(){return"json"}static get stepExecution(){return"json"}static get singleExecution(){return"json"}constructor(e,t,s={}){if(this.shadow=null,this.container=null,this.interpreterConstructor=t,this.options={historySize:s.historySize??this.#s,memory:s.memory??this.#o,steps:s.steps??this.#a},this.mainElement=null,this.fragment=document.createDocumentFragment(),this.history=[],this.historyIndex=-1,this.currentInputText="",this.interpreter=null,e instanceof ShadowRoot)this.shadow=e,this.container=e.getElementById("repl-container");else throw console.error("Invalid container provided to Repl constructor."),new Error("Invalid container provided to Repl constructor.  Must be a ShadowRoot.");this.lintOptions={esversion:6,undef:!1,unused:!1,expr:!0,trailingcomma:!1,strict:!1,singleGroups:!1,nonew:!1,nocomma:!1,curly:!1,asi:!0,boss:!1,debug:!0,elision:!0,eqnull:!0,evil:!1,loopfunc:!1},this.predefGlobals={},this.inStepExecution=!1}#e(){if(this.container)this.mainElement=document.createElement("div"),this.mainElement.id="editor",this.container.appendChild(this.mainElement);else throw new Error("No valid container provided to Repl.");this.#f(),this.#t()}#n=e=>{e.target.tagName!=="INPUT"&&this.#x()};#r=e=>{let t=`
[
  {
    "type": "input",
    "content": "5+5"
  },
  {
    "type": "output",
    "content": "10"
  },
  {
    "type": "input",
    "content": "console.log(4)"
  },
  {
    "type": "log",
    "content": "4"
  },
  {
    "type": "input",
    "content": "x=:"
  },
  {
    "type": "exception",
    "content": "Exception: Unexpected token (1:2)"
  },
  {
    "type": "input",
    "content": ""
  }
]
`;if(e.ctrlKey||e.metaKey)switch(e.key){case"d":e.preventDefault(),this.saveSession();break;case"g":e.preventDefault(),console.log(this.getState());break;case"s":e.preventDefault(),this.setState(t);break;case"i":e.preventDefault(),S({startFile:"start.md",helpFile:"help.md",aboutFile:"about.md",contactFile:"contact.md"},this.shadow);break;case"u":e.preventDefault(),this.uploadFile();break}};#i(e){let t={ENTER:13,ESCAPE:27,UP_ARROW:38,DOWN_ARROW:40,LEFT_ARROW:37,RIGHT_ARROW:39,TAB:9,V:86,BACKSPACE:8},s=e.which,n=e.target,i=e.ctrlKey||e.metaKey,r=null;if(s===t.ENTER)if(i)this.#c();else{let a=n.selectionStart,o=n.value,l=o.substring(0,a);n.value=l;let c=o.substring(a),p=n.parentNode.parentNode;r=this.#t(),r.value=c,p.insertAdjacentElement("afterend",r.parentNode.parentNode),r.focus(),e.preventDefault()}else if(s===t.ESCAPE)n.blur();else if(s===t.UP_ARROW)i?this.#v(-1,n):this.#y(-1,n);else if(s===t.DOWN_ARROW)i?this.#v(1,n):this.#y(1,n);else if(s===t.LEFT_ARROW)n.selectionStart===0&&(e.preventDefault(),this.#A(n));else if(s===t.RIGHT_ARROW)n.selectionStart===n.value.length&&(e.preventDefault(),this.#w(n));else if(s===t.TAB){e.preventDefault();let a="	",o=n.selectionStart,l=n.selectionEnd,c=n.value;n.value=c.substring(0,o)+a+c.substring(l),n.selectionStart=n.selectionEnd=o+a.length}else if(s===t.V&&i)e.preventDefault(),navigator.clipboard.readText().then(a=>{let o=a.split(`
`),l=n.parentNode.parentNode;n.value+=o[0];let c=n;for(let d=1;d<o.length;d++)r=this.#t(),r.value=o[d],c=r,l.insertAdjacentElement("afterend",r.parentNode.parentNode),l=r.parentNode.parentNode;c&&c.focus();let p=f();p.event="pasteText",p.type="editor",p.source="user",p.state.code=a,h(p.event,p,this.container)}).catch(a=>{console.error("Failed to read clipboard contents: ",a),alert("Failed to paste text. Please try again.")});else if(s===t.BACKSPACE&&n.selectionStart===0){let a=n.parentNode.parentNode,o=a.previousElementSibling;if(o){let l=o.querySelector("input");if(l&&l.disabled===!1){e.preventDefault();let c=l.value.length;l.value+=n.value,a.remove(),l.focus(),l.selectionStart=l.selectionEnd=c}}}}#f(){this.mainElement.addEventListener("click",this.#n),this.mainElement.addEventListener("keydown",this.#r)}#m(){this.mainElement&&(this.mainElement.removeEventListener("click",this.#n),this.mainElement.removeEventListener("keydown",this.#r))}#L(e){let t=[],s={browser:!0,bitwise:!0,convert:!1,devel:!0,eval:!1,fart:!0,for:!0,getset:!0,indent2:!1,long:!0,node:!1,nomen:!0,single:!0,subscript:!0,this:!0,trace:!1,unordered:!0,white:!0},n,i=e,r=f();return r.event="codeQualityCheck",r.type="linter",r.source="system",r.state.code=e,r.state.options=s,r.state.errors=null,n=jslint.jslint(i,s,t),n.warnings.length>0?(r.state.errors=n.warnings,h(r.event,r,this.container),console.log(n.warnings),this.displayMessage("linting warnings found:",n.warnings),!1):(h(r.event,r,this.container),!0)}#b(e){let t,s=e;JSHINT(e,this.lintOptions,this.predefGlobals),t=JSHINT.data(),t&&t.errors&&t.errors.length>0&&t.errors.forEach(n=>{let i=f();i.event="codeQualityCheck",i.type="linter",i.source="system",i.state.code=e,i.state.options=this.lintOptions,i.state.error={},i.state.error.reason=n.reason,i.state.evidence=n.evidence,h(i.event,i,this.container),this.displayMessage(`linting warning: ${n.reason}`)})}#t(){let e=this.#l("ul",{class:"prompt"}),t=this.#l("li",{class:"list"}),s=this.#l("input");return s.addEventListener("keydown",this.#i.bind(this)),t.appendChild(s),e.appendChild(t),this.fragment.appendChild(e),this.mainElement.appendChild(this.fragment),s.focus(),e.addEventListener("click",n=>{if(n.target===e){let i=e,r=[];for(;i&&i.previousElementSibling&&i.previousElementSibling.querySelector("input");)i=i.previousElementSibling;for(;i&&i.querySelector("input");){let l=i.querySelector("input");l&&r.push(l),i=i.nextElementSibling}let a="";r.forEach(l=>{a+=l.value+`
`;try{l.select()}catch(c){console.error("Error selecting input:",c)}});let o=a.trim();if(o==="")console.log("no text to copy");else{let l=f();l.event="inputCopy",l.type="inputSelector",l.source="user",l.state.text=o,h(l.event,l,this.container),x(o),r.forEach(c=>{c.classList.add("selected-prompt"),setTimeout(()=>c.classList.remove("selected-prompt"),500)}),this.displayMessage("input copied")}}}),s}#l(e,t={}){let s=document.createElement(e);return t.class&&(s.className=t.class),t.text&&(s.textContent=t.text),t.html&&(s.innerHTML=t.html),s}#g(){let e=this.mainElement.querySelectorAll("ul.prompt li input:not(:disabled)"),t=[],s=[];e.forEach(r=>{let a=r.value.trim();a!==""&&(t.push(a),this.#S(a),s.push(r.closest("ul.prompt"))),r.disabled=!0,r.style.opacity=.5}),s.length>1&&s.forEach(r=>{r.dataset.multiline="true"});let n="";if(t.length>0&&(n=t.join(`
`)),n.trim()==="clear")return this.clearSession(),"";let i=n.trim();return i===""?(this.#t(),""):(i.startsWith("{")&&i.endsWith("}")&&!i.startsWith("(")&&!i.endsWith(")")&&(i=`(${i})`),this.#b(n),this.#p(),this.interpreter.consoleLogs=[],this.interpreter.add(i),i)}#c(){let e={success:!0,message:"Operation performed."},t="";if(!this.inStepExecution)try{t=this.#g()}catch(s){return this.#u(t,"",s.message,[]),this.#t(),e.success=!1,e.message=s.message,e}return this.inStepExecution=!1,t===""?(e.message="Nothing to execute.",e):this.#E(t)}nextStep(){let e="";if(!this.inStepExecution){try{e=this.#g()}catch(a){return this.#u(e,"",a.message,[]),this.#t(),{success:!1,message:a.message}}this.inStepExecution=!0}let{result:t,done:s,error:n,consoleLogs:i}=this.interpreter.runStep(),r=n||"execution in progress";return t!==null&&t!=="statement executed"&&this.#u(e,t,n,i,u.stepExecution),s&&(this.inStepExecution=!1,this.#t(),r="execution is complete",this.displayMessage(r)),{success:!0,message:r}}#E(e){let t={success:!0,message:"Operation performed."};try{this.#p();let{result:s,done:n,error:i,consoleLogs:r}=this.interpreter.run();this.#u(e,s,i,r),this.#t()}catch(s){t.success=!1,t.message=s.message}return t}#u(e,t,s,n,i=u.singleExecution){let r=f();r.event="codeExecution",r.type="interpreter",r.source="user",r.state.code=e,r.state.output=null,r.state.error=null;let a=!1;if(typeof n=="object"&&n!==null&&Array.isArray(n)&&n.length>0&&(a=!0,n.forEach(o=>{o.type&&Array.isArray(o.args)&&o.args.forEach(l=>{let c;try{typeof l=="object"&&l!==null||Array.isArray(l)?c=JSON.stringify(l,null,2):c=String(l)}catch{c=String(l)}this.#d(c,o.type)})})),s)r.state.error=s,this.#d("Exception: "+JSON.stringify(s),u.exception);else if(t!==void 0&&!a){let o;try{typeof t=="object"&&t!==null||Array.isArray(t)?o=JSON.stringify(t,null,2):o=String(t)}catch{o=String(t)}o!=="null"&&(r.state.output=o,this.#d(o,u.output))}else!a&&t===void 0&&i===u.singleExecution&&this.#d("statement executed",u.output);h(r.event,r,this.container)}#S(e){e.trim()!==""&&(this.history.length===0||this.history[this.history.length-1]!==e)&&(this.history.push(e),this.history.length>this.options.historySize&&this.history.shift()),this.historyIndex=this.history.length}#y(e,t){let s=Array.from(this.mainElement.querySelectorAll("ul.prompt li input:not(:disabled)")),n=s.indexOf(t);if(e===-1){if(n>0){let i=s[n-1];i.focus(),i.selectionStart=i.value.length,i.selectionEnd=i.value.length}}else if(e===1&&n<s.length-1){let i=s[n+1];i.focus(),i.selectionStart=i.value.length,i.selectionEnd=i.value.length}}#v(e,t){if(this.history.length===0)return;e===-1?this.historyIndex===-1?(this.currentInputText=t.value,this.historyIndex=this.history.length-1):(this.historyIndex-=1,this.historyIndex<0&&(this.historyIndex=-1)):e===1&&(this.historyIndex===-1?(this.historyIndex=this.history.length>0?0:-1,this.currentInputText=t.value):(this.historyIndex+=1,this.historyIndex>=this.history.length&&(this.historyIndex=-1)));let s="";this.historyIndex>=0&&this.historyIndex<this.history.length?s=this.history[this.historyIndex]:s=this.currentInputText,t.value=s,t.selectionStart=t.value.length,t.selectionEnd=t.value.length}#p(){this.interpreter||(this.interpreter=new this.interpreterConstructor(this.shadow,this.options))}#d(e,t=u.output){try{let s=this.#l("ul",{class:t}),n=this.#l("li",{class:"list"}),i=this.#l("pre",{html:C(e)});n.appendChild(i),s.appendChild(n),this.fragment.appendChild(s),this.mainElement.appendChild(this.fragment),s.addEventListener("click",r=>{if(r.target===s){let a=s,o=[];for(;a&&a.previousElementSibling&&!a.previousElementSibling.classList.contains("prompt");)a=a.previousElementSibling;for(;a&&!a.classList.contains("prompt");)a.querySelector("pre")&&o.push(a.querySelector("pre")),a=a.nextElementSibling;let l="";o.forEach(d=>{l+=d.textContent+`
`});let c=l.trim(),p=f();p.event=t+"Copy",p.type=t+"Selector",p.source="user",p.state.text=c,h(p.event,p,this.container),x(c),o.forEach(d=>{d.classList.add("selected-output"),setTimeout(()=>d.classList.remove("selected-output"),500)}),this.displayMessage(t+" copied")}})}catch(s){console.error("Error in #appendOutput:",s)}}#x(){let e=this.#h();e&&e.focus()}#h(){let e=this.mainElement.querySelectorAll("ul.prompt li input"),t=null;for(let s of e)s.disabled||(t=s);return t}#A(e){let t=Array.from(this.mainElement.querySelectorAll("ul.prompt li input")),s=t.indexOf(e);if(s>0){let n=t[s-1];n.disabled||(n.focus(),n.selectionStart=n.selectionEnd=n.value.length)}}#w(e){let t=Array.from(this.mainElement.querySelectorAll("ul.prompt li input")),s=t.indexOf(e);if(s<t.length-1){let n=t[s+1];n.disabled||(n.focus(),n.selectionStart=0,n.selectionEnd=0)}}#I(){let e=[];(this.mainElement?.childNodes??[]).forEach(n=>{if(n.nodeType===Node.ELEMENT_NODE)if(n.classList.contains("prompt")){let i=n.querySelector("input");i&&e.push({type:"input",content:i.value})}else{let r=Object.getOwnPropertyNames(u).filter(o=>{let l=Object.getOwnPropertyDescriptor(u,o);return l&&typeof l.get=="function"}).map(o=>u[o]).find(o=>Array.from(n.classList).includes(o)),a=n.querySelector("pre");e.push({type:r??"unknown",content:a?.textContent??""})}});let s=e.length>0;return{success:s,data:e,message:s?"Session serialized successfully.":"No elements found in REPL."}}#C(e){if(typeof e!="string")return!1;try{return JSON.parse(e),!0}catch{return!1}}start(){this.#e()}dispose(){this.#m(),this.mainElement=null,this.container=null}injectApi(e,t){this.#p();let s=f();if(s.event="injectApi",s.type="host",s.source="system",s.state.name=e,s.state.api=t,typeof this.interpreter.injectApi=="function"){let n=this.interpreter.injectApi(e,t);s.state.success=n.success,s.state.message=n.message,n.success||console.warn(`API injection failed: ${n.message}`)}else s.state.success=!1,s.state.message="Interpreter does not support API injection.",console.warn(s.state.message);return h(s.event,s,this.container),{success:s.state.success,message:s.state.message}}removeApi(e){let t=f();if(t.event="removeApi",t.type="host",t.source="system",t.state.name=e,typeof this.interpreter.removeApi=="function"){let s=this.interpreter.removeApi(e);t.state.success=s.success,t.state.message=s.message,s.success||console.warn(`API removal failed: ${s.message}`)}else t.state.success=!1,t.state.message="Interpreter does not support API removal.",console.warn(t.state.message);return h(t.event,t,this.container),{success:t.state.success,message:t.state.message}}removeAllApis(){if(this.#p(),typeof this.interpreter.removeAllApis=="function"){this.interpreter.removeAllApis();let e=f();e.event="removeAllApis",e.type="host",e.source="system",h(e.event,e,this.container)}else console.warn("Interpreter does not support API removal.")}getLintConfig(){return{options:{...this.lintOptions},predef:{...this.predefGlobals}}}setLintConfig(e){if(e&&typeof e=="object"){let t=e.options&&typeof e.options=="object"?e.options:this.lintOptions,s=e.predef&&Array.isArray(e.predef)?{}:{...this.predefGlobals};e.predef&&Array.isArray(e.predef)&&e.predef.forEach(n=>{s[n]=!0}),this.lintOptions=t,this.predefGlobals=s,this.displayMessage("lint configuration was successful");return}this.displayMessage("lint configuration was unsuccessful. previous configuration is preserved.")}getMetadata(){return{elements:[{name:"editor",events:["pasteText","fileUpload","getCode","setCode","saveCode","getSession","setSession","saveSession","clearSession"]},{name:"linter",events:["codeQualityCheck"]},{name:"interpreter",events:["codeExecution"]},{name:"host",events:["injectApi","removeApi","removeAllApis"]},{name:"inputSelector",events:["inputCopy"]},{name:"outputSelector",events:["outputCopy"]},{name:"exceptionSelector",events:["exceptionCopy"]},{name:"logSelector",events:["logCopy"]},{name:"warningSelector",events:["warningCopy"]},{name:"errorSelector",events:["errorCopy"]}]}}insertAndExecuteCode(e){let t=this.#h();return t?(t.value.trim()!==""&&(t=this.#t()),t.value=e,this.#c()):(console.warn("Input prompt not available."),{success:!1,message:"Input prompt not available."})}uploadFile(){return new Promise(e=>{function t(n){let i=n.lastIndexOf(".");return i!==-1?n.slice(i+1):""}let s=document.createElement("input");s.type="file",s.accept=".json, .js",s.addEventListener("change",n=>{let i=n.target.files[0];if(!i){let o="No file selected.";return this.displayMessage(o),e({success:!1,message:o})}let r=t(i.name),a=new FileReader;a.onload=o=>{let l=o.target.result,c=null,p=null;try{p=this.setState(l,r==="js"?u.js:u.json)}catch(m){c=m.message}let d=f();if(d.event="fileUpload",d.type="editor",d.source="user",d.state.content=l,d.state.file=i.name,d.state.error=c,h(d.event,d,this.container),c){let m=`Failed to upload file "${i.name}": ${c}`;return this.displayMessage(m),e({success:!1,message:m})}else{let m=`File "${i.name}" uploaded successfully.`;return this.displayMessage(m),e({success:!0,message:m})}},a.onerror=()=>{let o=`Error reading file "${i.name}"`;return this.displayMessage(o),e({success:!1,message:o})},a.readAsText(i)}),s.click()})}getCode(e=!0){let t={success:!1,code:"",message:"",onlyValid:e};try{let s=this.getState();if(!s.success)return t.message=`Failed to get state: ${s.message}`,t;let n=s.data,i=[],r=[];for(let o=0;o<n.length;o++){let l=n[o];l.type==="input"?r.push({content:l.content,isValid:!0}):l.type==="exception"&&r.length>0&&(r[r.length-1].isValid=!1)}for(let o of r)(!e||o.isValid)&&i.push(o.content);t.code=i.join(`
`),t.success=!0,t.message="Code extracted successfully!";let a=f();return a.event="getCode",a.type="editor",a.source="user",a.state.code=t.code,a.state.onlyValid=e,h(a.event,a,this.container),t}catch(s){return t.message=`Error during code extraction: ${s.message}`,t}}saveCode(e=!0){let t={success:!1,message:""};try{let s=this.getCode(e);if(!s.success)return t.message=`Failed to get code: ${s.message}`,this.displayMessage(t.message,"error"),t;let n=new Blob([s.code],{type:"application/javascript"}),i=URL.createObjectURL(n),r=document.createElement("a"),a=Math.floor(Date.now()/1e3);r.href=i,r.download=`repl_code_${a}.js`,document.body.appendChild(r),r.click(),document.body.removeChild(r),URL.revokeObjectURL(i);let o=f();o.event="saveCode",o.type="editor",o.source="user",o.state.code=s.code,o.state.onlyValid=e,h(o.event,o,this.container),this.displayMessage("Code saved successfully."),t.success=!0,t.message="Code saved successfully."}catch(s){let n=`Failed to save code: ${s.message}`;console.error(n),this.displayMessage(n),t.message=n}return t}getState(){let e=this.#I();if(e.success){let t=f();t.event="getSession",t.type="editor",t.source="user",t.state=e.data,h(t.event,t,this.container)}else console.warn(e.message);return e}setState(e,t=u.json){let s,n=null,i={success:!1,message:""};if(t===u.json)try{s=JSON.parse(e),Array.isArray(s)||(n="Session data must be a JSON array.")}catch(o){n=`Invalid JSON session data provided: ${o.message}`}else t===u.js?(this.#C(e)&&(n="Inconsistent data type: Expected plain text for 'js' type but received JSON."),s=e.split(`
`)):n=`Invalid data type provided: '${t}'. Expected 'json' or 'js'.`;let r=f();if(r.event=t===u.json?"setSession":"setCode",r.type="editor",r.source="user",r.state.data=s,r.state.error=n,h(r.event,r,this.container),n)return i.message=n,this.displayMessage(`Error loading session: ${n}`),i;this.clearSession(),t===u.json?(()=>{for(let l=0;l<s.length;l++){let c=s[l];if(c.type==="input"){let p=this.#h();p?(p.value=c.content,this.#c()):console.warn("no active input prompt found for JSON input item")}else console.warn("skipping non-input line during setState:",c.type,c.content)}})():(s.forEach((o,l)=>{if(l===0){let c=this.#h();c?c.value=o:console.warn("no active input prompt found for first text line")}else{let c=this.#t();c.value=o}}),this.#c());let a=this.mainElement.querySelector("ul.prompt:last-child li input");return a&&a.focus(),i.success=!0,i.message="Session loaded successfully!",this.displayMessage(i.message),i}saveSession(){let e={success:!1,message:""};try{let t=this.getState();if(!t.success)return e.message=`Failed to get state: ${t.message}`,this.displayMessage(e.message,"error"),e;let s=JSON.stringify(t.data,null,2),n=new Blob([s],{type:"application/json"}),i=URL.createObjectURL(n),r=document.createElement("a"),a=Math.floor(Date.now()/1e3);r.href=i,r.download=`repl_session_${a}.json`,document.body.appendChild(r),r.click(),document.body.removeChild(r),URL.revokeObjectURL(i);let o=f();o.event="saveSession",o.type="editor",o.source="user",o.state.session=s,h(o.event,o,this.container),this.displayMessage("Session saved successfully."),e.success=!0,e.message="Session saved successfully."}catch(t){let s=`Failed to save session: ${t.message}`;console.error(s),this.displayMessage(s),e.message=s}return e}clearSession(){try{this.mainElement.innerHTML="",this.interpreter?.reset(),this.#t(),this.history=[],this.historyIndex=-1;let e=f();return e.event="clearSession",e.type="editor",e.source="user",h(e.event,e,this.container),{success:!0,message:"Session cleared successfully!"}}catch(e){let t=`Failed to clear session: ${e.message}`;return console.error(t),{success:!1,message:t}}}displayMessage(e){I(e,this.shadow)}displayInfo(){S({startFile:"start.md",helpFile:"help.md",aboutFile:"about.md",contactFile:"contact.md"},this.shadow)}};var v=class{#o=512*1024;#a=1e4;#s=null;consoleLogs=[];constructor(e,t={}){this.host=e,this.apis=[],this.options={memory:t.memory??this.#o,steps:t.steps??this.#a},this.vm=null,this.isInitialized=!1,this.debug=!1,this.steps=[],this.#e(),this.#s=null}#e(e=""){this.#n(e),this.isInitialized=!0}#n(e=""){this.vm=new Interpreter(e,(t,s)=>{this.#r(t,s)}),this.#m()}#r(e,t){this.globalObject=t,e.setProperty(t,"alert",e.createNativeFunction(n=>alert(n))),e.setProperty(t,"prompt",e.createNativeFunction(n=>prompt(n))),e.setProperty(t,"confirm",e.createNativeFunction(n=>confirm(n)));let s=e.createObject(e.OBJECT);e.setProperty(t,"console",s),e.setProperty(s,"log",e.createNativeFunction((...n)=>{let i=n.map(r=>this.#i(r));this.consoleLogs.push({type:"log",args:i}),console.log("[Interpreter]",...i)})),e.setProperty(s,"warn",e.createNativeFunction((...n)=>{let i=n.map(r=>this.#i(r));this.consoleLogs.push({type:"warning",args:i}),console.warn("[Interpreter]",...i)})),e.setProperty(s,"error",e.createNativeFunction((...n)=>{let i=n.map(r=>this.#i(r));this.consoleLogs.push({type:"error",args:i}),console.error("[Interpreter]",...i)})),e.setProperty(t,"print",e.createNativeFunction((...n)=>{let i=n.map(r=>this.#i(r));this.consoleLogs.push({type:"output",args:i})}))}#i(e){if(typeof e!="object"||e===null)return e;if(Object.prototype.hasOwnProperty.call(e,"properties")&&Object.prototype.hasOwnProperty.call(e,"proto")&&typeof e.properties=="object"&&e.properties!==null){let n=e.class==="Array"?[]:{};for(let i in e.properties)if(Object.prototype.hasOwnProperty.call(e.properties,i)){let r=e.properties[i];n[i]=this.#i(r)}return n}let s=Array.isArray(e)?[]:{};for(let n in e)Object.prototype.hasOwnProperty.call(e,n)&&(s[n]=this.#i(e[n]));return s}#f(){let e=this.vm.getStateStack(),t=new Set,s=[e],n=0;for(;s.length;){let i=s.pop();n+=8;let r=typeof i;if(r==="string"&&!t.has(i))n+=i.length*2,t.add(i);else if(r==="object"&&i!==null&&!t.has(i)){let a=Object.keys(i),o=Object.values(i);try{s.push(...a,...o)}catch{s=s.concat(a,o)}t.add(i)}}return n}#m(){this.isInitialized&&this.apis.forEach(e=>{let t=this.injectApi(e.name,e.api);t?.success||console.warn(`Failed to inject API '${e.name}': ${t?.message||"Unknown error"}`)})}setMaxMemory(e){typeof e=="number"&&e>0?(this.options.memory=e,console.log(`NFInterpreter: Max memory updated to ${e} bytes.`)):console.warn(`NFInterpreter: Invalid 'memory' value provided to setMaxMemory: ${e}. Value must be a positive number.`)}setMaxSteps(e){typeof e=="number"&&e>0?(this.options.steps=e,console.log(`NFInterpreter: Max steps updated to ${e}.`)):console.warn(`NFInterpreter: Invalid 'steps' value provided to setMaxSteps: ${e}. Value must be a positive number.`)}getMaxMemory(){return this.options.memory}getMaxSteps(){return this.options.steps}injectApi(e,t){let s={success:!1,message:""};if(!this.vm)return s.message="Interpreter not initialized. Call #init() first or ensure VM is created before calling injectApi.",console.error(s.message,"error"),s;let n;if(typeof t=="string")try{n=new Function("return "+t)()}catch(a){return s.message=`Failed to evaluate API object string: ${a.message}`,console.error(s.message),s}else if(typeof t=="object"||typeof t=="function")n=t;else return s.message=`Invalid apiObject type: ${typeof t}. Must be a string or object.`,console.error(s.message),s;let i=this.vm,r=(a,o)=>{if(!o){console.warn("Target is undefined in createObjectRecursive for:",a);return}let l=Array.isArray(a)?Array.from({length:a.length},(c,p)=>p):Object.keys(a);for(let c of l){let p=a[c];if(typeof p=="function"){let d=function(...m){let E=this,P=m.map(g=>i.pseudoToNative(g)),w={};for(let g in E.properties)Object.prototype.hasOwnProperty.call(E.properties,g)&&g!==c&&(w[g]=i.pseudoToNative(E.properties[g]));let N=p.apply(w,P);return i.nativeToPseudo(N)};i.setProperty(o,c,i.createNativeFunction(d))}else if(typeof p=="object"&&p!==null){let d=i.createObject(Array.isArray(p)?i.ARRAY:i.OBJECT);i.setProperty(o,c,d),r(p,d)}else i.setProperty(o,c,i.nativeToPseudo(p))}};try{let a=i.createObject(i.OBJECT);r(n,a),i.setProperty(this.globalObject,e,a);let o=this.apis.findIndex(l=>l.name===e);return o!==-1?this.apis[o].api=t:this.apis.push({name:e,api:t}),s.success=!0,s.message=`API '${e}' injected successfully.`,s}catch(a){return s.message=`Error during API injection: ${a.message}`,console.error(s.message,"error"),s}}removeApi(e){if(!this.vm){let i="Interpreter not initialized.";return console.error(i),{success:!1,message:i}}let t=this.vm;if(!this.apis.some(i=>i.name===e)){let i=`API '${e}' not found in interpreter.`;return console.warn(i),{success:!1,message:i}}t.setProperty(this.globalObject,e,t.UNDEFINED),this.apis=this.apis.filter(i=>i.name!==e);let n=`API '${e}' removed from interpreter.`;return console.info(n),{success:!0,message:n}}removeAllApis(){if(!this.vm)return console.error("Interpreter not initialized."),{success:!1,message:"Interpreter not initialized."};let e=[],t=this.apis.map(s=>s.name);for(let s of t){let n=this.removeApi(s);e.push({name:s,...n})}return{success:e.every(s=>s.success),results:e,message:e.length===0?"No APIs to remove.":"Finished removing APIs. Check individual results for details."}}add(e){if(!this.isInitialized)return{error:"Interpreter not initialized. Call #init() first."};e&&(this.#s=serialize(this.vm),this.vm.appendCode(e))}run(){try{let e=null,t=0;for(this.vm.value=void 0;this.vm.step();){if(t++,this.#f()>this.options.memory)throw new Error("Memory limit exceeded");if(t>this.options.steps)throw new Error("Step limit exceeded")}return e=this.#i(this.vm.value),{result:e,done:this.isDone(),error:null,consoleLogs:this.consoleLogs}}catch(e){return console.error(e.message),this.#n(),this.#s&&deserialize(this.#s,this.vm),{result:"",error:e.message,done:this.isDone(),consoleLogs:this.consoleLogs}}}runStep(){this.consoleLogs=[];let e=null;this.vm.value=void 0;try{return this.vm.step()?e=this.#i(this.vm.value):console.log("[Interpreter] Execution complete"),{result:e,done:this.isDone(),error:null,consoleLogs:this.consoleLogs}}catch(t){return console.error(t.message),this.#n(),this.#s&&deserialize(this.#s,this.vm),{result:"",error:t.message,done:this.isDone(),consoleLogs:this.consoleLogs}}}status(){if(!this.isInitialized)return{error:"Interpreter not initialized. Call #init() first."};switch(this.vm.getStatus()){case Interpreter.Status.DONE:return{status:"DONE",description:"The interpreter has finished executing all code.",stack:this.vm.stateStack};case Interpreter.Status.STEP:return{status:"STEP",description:"The interpreter has code to be executed and is ready to take another step.",stack:this.vm.stateStack};case Interpreter.Status.TASK:return{status:"TASK",description:"The interpreter doesn't have any code to be executed at the moment, but there's a pending setTimeout/setInterval task which will provide code at some future time.",stack:this.vm.stateStack};case Interpreter.Status.ASYNC:return{status:"ASYNC",description:"The interpreter's execution is blocked by an asynchronous function call which is currently executing.",stack:this.vm.stateStack};default:return{}}}isDone(){return this.vm?this.vm.getStatus()===Interpreter.Status.DONE:!1}reset(e=!1){this.dispose(),e&&(this.apis=[]),this.#e()}dispose(){this.vm&&(this.vm.dispose?.(),this.vm=null,this.isInitialized=!1)}};window.NFInterpreter=v;var L=document.createElement("template");L.innerHTML=`
  <style>
    :host {
      display: block;
    }
  </style>
  <div id="repl-container">
    <div id="toast-container"></div>
  </div>
`;var A=class extends HTMLElement{#o=null;#a=!1;#s=null;#e=null;#n=50;#r=[];constructor(){super();let e=this.attachShadow({mode:"open"});["css/base.css","css/repl.css","css/theme.css","css/utils.css","css/info.css"].forEach(s=>{let n=document.createElement("link");n.rel="stylesheet",n.href=s,n.type="text/css",n.onerror=()=>console.warn(`failed to load style: ${s}`),n.onload=()=>{},e.appendChild(n)}),e.appendChild(L.content.cloneNode(!0)),this.#a=!1}static get observedAttributes(){return["history-size","max-memory","max-steps"]}attributeChangedCallback(e,t,s){if(e==="history-size"){let n=Number.parseInt(s,10);!Number.isNaN(n)&&n>=0&&(this.#n=n,this.#e&&(this.#e.options.historySize=this.#n))}else if(e==="max-memory"){let n=Number.parseInt(s,10);!Number.isNaN(n)&&n>0?this.#e&&(this.#e.options.memory=n,this.#e.interpreter&&this.#e.interpreter.setMaxMemory(n)):console.warn(`Invalid 'max-memory' value: ${s}. Must be a positive number.`)}else if(e==="max-steps"){let n=Number.parseInt(s,10);!Number.isNaN(n)&&n>0?this.#e&&(this.#e.options.steps=n,this.#e.interpreter&&this.#e.interpreter.setMaxSteps(n)):console.warn(`Invalid 'max-steps' value: ${s}. Must be a positive number.`)}}connectedCallback(){this.#o=this.shadowRoot?.getElementById("repl-container"),this.#s=this.shadowRoot?.getElementById("toast-container");let e=Number.parseInt(this.getAttribute("max-memory"),10),t=Number.parseInt(this.getAttribute("max-steps"),10);try{this.#e=new y(this.shadowRoot,v,{historySize:this.#n,memory:!Number.isNaN(e)&&e>0?e:void 0,steps:!Number.isNaN(t)&&t>0?t:void 0}),this.#e.start()}catch(n){console.error("Failed to instantiate REPL:",n),this.dispatchEvent(new CustomEvent("replError",{bubbles:!0,composed:!0,detail:{message:"Failed to instantiate REPL."}}));return}["pasteText","fileUpload","getCode","setCode","saveCode","getSession","setSession","saveSession","clearSession","codeQualityCheck","codeExecution","injectApi","removeApi","removeAllApis","inputCopy","outputCopy","exceptionCopy","logCopy","warningCopy","errorCopy","replError"].forEach(n=>{let i=r=>{if(!r.bubbles||!r.composed){let a=new CustomEvent(r.type,{detail:r.detail,bubbles:!0,composed:!0,cancelable:r.cancelable});this.dispatchEvent(a)}};this.#o.addEventListener(n,i),this.#r.push({eventName:n,handler:i})})}disconnectedCallback(){super.disconnectedCallback?.(),console.info("<yabri> disconnected; cleaning up APIs"),this.dispose()}injectApi(e,t){return this.#e?this.#e.injectApi(e,t):(console.warn(`REPL instance is not available. Could not inject API: ${e}`),{success:!1,message:"REPL instance is not available."})}removeApi(e){return this.#e?this.#e.removeApi(e):(console.warn("REPL instance is not available."),{success:!1,message:"REPL instance is not available."})}removeAllApis(){if(!this.#e){console.warn("REPL instance is not available.");return}console.log("removing all APIs"),this.#e?.removeAllApis()}getLintConfig(){return this.#e?this.#e?.getLintConfig():(console.warn("REPL instance is not available."),{})}setLintConfig(e){if(!this.#e){console.warn("REPL instance is not available.");return}this.#e?.setLintConfig(e)}getMetadata(){if(!this.#e)return console.warn("REPL instance is not available."),{};let e=this.#e?.getMetadata();return e?.elements?.push({name:"repl",events:["replError"]}),e}insertAndExecuteCode(e){return this.#e?this.#e?.insertAndExecuteCode(e):(console.warn("REPL instance is not available."),{success:!1,message:"REPL instance is not available."})}nextStep(){return this.#e?this.#e?.nextStep():(console.warn("REPL instance is not available."),{success:!1,message:"REPL instance is not available."})}async uploadFile(){return this.#e?await this.#e?.uploadFile():(console.warn("REPL instance is not available."),{success:!1,message:"REPL instance not available."})}getCode(e=!0){return this.#e?this.#e?.getCode(e):(console.warn("REPL instance is not available."),{success:!1,code:"",message:"REPL instance not available.",onlyValid:e})}saveCode(e=!0){return this.#e?this.#e?.saveCode(e):(console.warn("REPL instance is not available."),{success:!1,message:"REPL instance not available."})}getState(){return this.#e?this.#e.getState():(console.warn("REPL instance is not available."),{success:!1,data:[],message:"REPL instance is not available."})}setState(e,t=y.json){return this.#e?this.#e?.setState(e,t):(console.warn("REPL instance is not available."),{success:!1,message:"REPL instance is not available."})}getSession(){return this.#e?this.getState():(console.warn("REPL instance is not available."),{success:!1,data:[],message:"REPL instance is not available."})}setSession(e,t=y.json){return this.#e?this.setState(e,t):(console.warn("REPL instance is not available."),{success:!1,message:"REPL instance is not available."})}saveSession(){if(!this.#e){let e="REPL instance is not available.";return console.warn(e),{success:!1,message:e}}return this.#e.saveSession()}clearSession(){if(!this.#e){let e="REPL instance is not available.";return console.warn(e),{success:!1,message:e}}return this.#e.clearSession()}displayMessage(e){if(!this.#e){console.warn("REPL instance is not available.");return}this.#e?.displayMessage(e)}displayInfo(){if(!this.#e){console.warn("REPL instance is not available.");return}this.#e?.displayInfo()}dispose(){if(!this.#a){if(this.#a=!0,this.removeAllApis(),this.#r.forEach(({eventName:e,handler:t})=>{console.log(`removing listener for ${e}`),this.#o.removeEventListener(e,t)}),console.log("resetting array of listeners"),this.#r=[],!this.#e){console.warn("REPL instance is not available.");return}console.log("disposing repl"),this.#e?.dispose()}}};customElements.get("yabri-terminal")||customElements.define("yabri-terminal",A);})();
